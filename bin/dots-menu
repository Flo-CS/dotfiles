#!/usr/bin/env bash

dmenu() {
	local prompt=$1
	wofi --dmenu --prompt "$prompt"
}

terminal() {
	alacritty --class Dots.Menu -e $@
}

waiting_terminal() {
	alacritty --class Dots.Menu -e bash -c "dots-show-logo; eval \"$@\"; dots-show-done;"
}

show_select_theme_menu() {
	selected=$(dots-theme-list | dmenu "Select theme")

	if [[ -z "$selected" ]]; then
		show_main_menu
	else
		dots-theme-set "$selected"
	fi
}

show_select_wallpaper_menu() {
	selected=$(dots-wallpaper-list | dmenu "Select wallpaper")

	if [[ -z "$selected" ]]; then
		show_main_menu
	else
		dots-wallpaper-set "$selected"
	fi
}

show_refresh_menu() {
	selected=$(fd '^dots-refresh-' "$DOTS_DIR/bin" -x basename {} | sed 's/^dots-refresh-//' | dmenu "Refresh menu")

	if [[ -z "$selected" ]]; then
		show_main_menu
	else
		cmd=${selected// /-}
		dots-refresh-$cmd
	fi
}

show_update_menu() {
	selected=$(printf 'ğŸ¦ Full
ğŸ—„ï¸ Dots binaries
â˜• Configs' | dmenu "Update menu")

	if [[ -z "$selected" ]]; then
		show_main_menu
	else
		case "$selected" in
		*"Full"*) waiting_terminal dots-update-full ;;
		*"Dots binaries"*) waiting_terminal dots-update-bin ;;
		*"Configs"*) waiting_terminal dots-update-config ;;
		esac
	fi
}

show_system_menu() {
	selected=$(printf 'ğŸ”„ Reboot
â» Shutdown
ğŸ”’ Lock' | dmenu "System menu")

	if [[ -z "$selected" ]]; then
		show_main_menu
	else
		case "$selected" in
		*"Reboot"*) systemctl reboot ;;
		*"Shutdown"*) systemctl poweroff ;;
		*"Lock"*) dots-lock-screen ;;
		esac
	fi
}

show_main_menu() {
	selected=$(printf 'ğŸ’… Theme
ğŸ”„ Refresh
ğŸŒ„ Wallpaper
ğŸ¦ Update
ğŸ“‡ System
ğŸ”µ Bluetooth
ğŸ›œ Network
ğŸ”Š Audio' | dmenu "Dots menu")

	case "$selected" in
	*"Theme"*) show_select_theme_menu ;;
	*"Refresh"*) show_refresh_menu ;;
	*"Wallpaper"*) show_select_wallpaper_menu ;;
	*"Update"*) show_update_menu ;;
	*"System"*) show_system_menu ;;
	*"Bluetooth"*) terminal bluetuith ;;
	*"Network"*) terminal nmtui ;;
	*"Audio"*) terminal wiremix ;;
	esac
}

show_main_menu
