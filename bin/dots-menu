#!/usr/bin/env bash

dmenu() {
	local prompt=$1
	wofi --dmenu --prompt "$prompt"
}

terminal() {
	alacritty --class Dots.Menu -e $1
}

show_select_theme_menu() {
	selected=$(dots-theme-list | dmenu "Select theme")

	if [[ -z "$selected" ]]; then
		show_main_menu
	fi

	dots-theme-set "$selected"
}

show_select_wallpaper_menu() {
	selected=$(dots-wallpaper-list | dmenu "Select wallpaper")

	if [[ -z "$selected" ]]; then
		show_main_menu
	fi

	dots-wallpaper-set "$selected"
}

show_refresh_menu() {
	selected=$(fd '^dots-refresh-' "$DOTS_DIR/bin" -x basename {} |
		sed 's/^dots-refresh-//' |
		dmenu "Refresh menu")

	if [[ -z "$selected" ]]; then
		show_main_menu
	fi

	cmd=${selected// /-}
	dots-refresh-$cmd
}

show_update() {
	git -C "$DOTS_DIR" pull
	$DOTS_DIR/install.sh
}

show_main_menu() {
	selected=$(printf "💅 Theme\n🔄 Refresh\n🌄 Wallpaper\n🍦 Update\n🪦 Shutdown\n" | dmenu "Dots menu")

	case "$selected" in
	*"Theme"*) show_select_theme_menu ;;
	*"Refresh"*) show_refresh_menu ;;
	*"Wallpaper"*) show_select_wallpaper_menu ;;
	*"Update"*) terminal show_update ;;
	*"Shutdown"*) shutdown ;;
	esac
}

show_main_menu
