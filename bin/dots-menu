#!/usr/bin/env bash

dmenu() {
	local prompt=$1
	wofi --dmenu --prompt "$prompt"
}

select_theme_menu() {
	echo $(dots-theme-list)
	selected=$(dots-theme-list | dmenu "Select theme")

	if [[ -z "$selected" ]]; then
		echo "No theme selected."
		exit 1
	fi

	echo "Selected theme: $selected"
	dots-theme-set "$selected"
}

refresh_menu() {
	selected=$(fd '^dots-refresh-' "$DOTS_DIR/bin" -x basename {} |
		sed 's/^dots-refresh-//' |
		dmenu "Refresh menu")

	if [[ -z "$selected" ]]; then
		echo "No refresh option selected."
		exit 1
	fi

	cmd=${selected// /-}
	"$DOTS_DIR/bin/dots-refresh-$cmd"
}

main_menu() {
	selected=$(printf "ðŸ’… Theme\nðŸ”„ Refresh\n" | dmenu "Dots menu")

	case "$selected" in
	*"Theme"*) select_theme_menu ;;
	*"Refresh"*) refresh_menu ;;
	*)
		echo "No valid option selected."
		exit 1
		;;
	esac
}

main_menu
