#!/usr/bin/env bash

hyprpm list |
    sed 's/\x1b\[[0-9;]*m//g' |
    awk '
/Repository/ {
       if(match($0, /Repository\s+(\S+)/, arr)) {
        repo = arr[1];
        sub(/:$/, "", repo);
    }
    next
}
/Plugin/ {
    if(match($0, /Plugin\s+(\S+)/, arr)) {
        plugin = arr[1];
    }
    next
}
/enabled/ {
    if(match($0, /enabled:\s*(\S+)/, arr)) {
        enabled = arr[1];
    }
    print repo " " plugin " " enabled
}' | jq -Rn '[inputs | split(" ") | {repo: .[0], plugin: .[1], enabled: (.[2] == "true")}]'
