#!/usr/bin/env bash

ICON_DIR="$HOME/.local/share/applications/icons"
DESKTOP_DIR="$HOME/.local/share/applications"

get_all_tuis() {
  find "$DESKTOP_DIR" -name '*.desktop' -print0 |
    while read -r -d '' file; do
      if grep -q '^Exec=.*alacritty.*-e' "$file"; then
        basename "${file%.desktop}"
      fi
    done | sort
}

remove_tui() {
  local app="$1"
  rm -f "$DESKTOP_DIR/$app.desktop"
  rm -f "$ICON_DIR/$app.png"
  echo "Removed $app"
}

if [ "$#" -eq 0 ]; then
  tuis=$(get_all_tuis)

  if [ -z "$tuis" ]; then
    echo "No TUIs to remove."
    exit 1
  fi

  selected=$(echo "$tuis" | gum choose --no-limit --header "Select TUI to remove..." --selected-prefix="âœ— ")

  if [ -z "$selected" ]; then
    echo "You must provide TUI names."
    exit 1
  fi

  echo "$selected" | while read -r app; do
    [ -n "$app" ] && remove_tui "$app"
  done
else
  for app in "$@"; do
    remove_tui "$app"
  done
fi
