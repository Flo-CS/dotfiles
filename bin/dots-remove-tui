#!/usr/bin/env bash

ICON_DIR="$HOME/.local/share/applications/icons"
DESKTOP_DIR="$HOME/.local/share/applications"

if [ "$#" -eq 0 ]; then
  # Find all TUIs by looking for desktop files with alacritty -e pattern
  tuis=$(find "$DESKTOP_DIR" -name '*.desktop' -print0 |
    while read -r -d '' file; do
      if grep -q '^Exec=.*alacritty.*-e' "$file"; then
        basename "${file%.desktop}"
      fi
    done | sort)

  if [ -z "$tuis" ]; then
    echo "No TUIs to remove."
    exit 1
  fi

  selected=$(echo "$tuis" | gum choose --no-limit --header "Select TUI to remove..." --selected-prefix="âœ— ")

  if [ -z "$selected" ]; then
    echo "You must provide TUI names."
    exit 1
  fi

  # Remove selected TUIs
  echo "$selected" | while read -r app; do
    if [ -n "$app" ]; then
      rm -f "$DESKTOP_DIR/$app.desktop"
      rm -f "$ICON_DIR/$app.png"
      echo "Removed $app"
    fi
  done
else
  # Remove specified TUIs
  for app in "$@"; do
    rm -f "$DESKTOP_DIR/$app.desktop"
    rm -f "$ICON_DIR/$app.png"
    echo "Removed $app"
  done
fi
