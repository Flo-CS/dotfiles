#!/usr/bin/env bash

ICON_DIR="$HOME/.local/share/applications/icons"
DESKTOP_DIR="$HOME/.local/share/applications"

if [ "$#" -eq 0 ]; then
    # Find all webapps by looking for desktop files with myarchy-launch-webapp pattern
    webapps=$(find "$DESKTOP_DIR" -name '*.desktop' -print0 |
        while read -r -d '' file; do
            if grep -q '^Exec=.*myarchy-launch-webapp.*' "$file"; then
                basename "${file%.desktop}"
            fi
        done | sort)

    if [ -z "$webapps" ]; then
        echo "No web apps to remove."
        exit 1
    fi

    selected=$(echo "$webapps" | gum choose --no-limit --header "Select web app to remove..." --selected-prefix="âœ— ")

    if [ -z "$selected" ]; then
        echo "You must provide web app names."
        exit 1
    fi

    # Remove selected webapps
    echo "$selected" | while read -r app; do
        if [ -n "$app" ]; then
            rm -f "$DESKTOP_DIR/$app.desktop"
            rm -f "$ICON_DIR/$app.png"
            echo "Removed $app"
        fi
    done
else
    # Remove specified webapps
    for app in "$@"; do
        rm -f "$DESKTOP_DIR/$app.desktop"
        rm -f "$ICON_DIR/$app.png"
        echo "Removed $app"
    done
fi
